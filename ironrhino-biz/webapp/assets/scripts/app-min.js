(function(){Observation.app=function(){$("form.report").attr("target","_blank");$("#report_format").children().click(function(){var a=$(this).attr("format");$("a.report").attr("href",function(c,b){c=b.indexOf("format=");c>0&&(b=b.substring(0,c-1));return b+("&format="+a)});$("form.report").each(function(){var c=$('input[name="format"]',this);c.length?c.val(a):$(this).prepend('<input type="hidden" name="format" value="'+a+'"/>')})});$("#shipped,#paid").click(function(){var a=$(this).nextAll("span:eq(0)");
$(this).is(":checked")?a.show():a.hide()});$("#customerName").blur(function(a){var c=$(a.target);(a=c.val())&&$.ajax({url:CONTEXT_PATH+"/biz/customer/json/"+a,dataType:"json",success:function(b){var a=$('select[name="salesman.id"]',c.closest("form")),d=$('select[name="stationId"]',c.closest("form"));b&&b.id?(c.val(b.name).siblings("span.info").html(""),b.memo&&(b=$.parseJSON(b.memo),document.location.search.indexOf("salesman.id")<0&&(b.salesman?a.val(b.salesman):$("option:selected",a).removeAttr("selected")),
b.station?d.val(b.station):$("option:selected",d).removeAttr("selected"))):(document.location.search.indexOf("salesman.id")<0&&$("option:selected",a).removeAttr("selected"),$("option:selected",d).removeAttr("selected"),c.siblings("span.info").html("\u5c06\u81ea\u52a8\u4fdd\u5b58\u4e3a\u65b0\u5ba2\u6237"))}})});var d={};$(".customerName").autocomplete({minLength:2,source:function(a,c){a.term in d?c(d[a.term]):$.ajax({url:CONTEXT_PATH+"/biz/customer/suggest",dataType:"json",data:a,success:function(b){d[a.term]=
b;c(b)}})},select:function(a){$(a.target).siblings("span.info").html("")}});$("select.fetchprice").change(function(a){var c=$(a.target),b=$("input.price:eq(0)",c.closest("tr"));(a=c.val())&&!b.val()&&$.ajax({url:CONTEXT_PATH+"/biz/product/json/"+a,dataType:"json",success:function(a){a.price&&(b.val(a.price),f());a.stock<=0?c.siblings("span.info").html("\u6ca1\u6709\u5e93\u5b58"):c.siblings("span.info").html("")}})});$("#orderItems input.quantity").blur(function(a){f();var c=$(a.target).val();if(c){var b=
$("select.fetchprice",$(a.target).closest("tr"));(a=b.val())&&!b.siblings("span.info").text()&&$.ajax({url:CONTEXT_PATH+"/biz/product/json/"+a,dataType:"json",success:function(a){$("input.price:eq(0)",b.closest("tr")).val(a.price||"");a.stock<c&&b.siblings("span.info").html("\u5e93\u5b58\u4e0d\u591f")}})}});$("#orderItems input.price,#discount,#freight").blur(function(){f()});$("#orderItems table").datagridTable({onremove:f})};var f=function(d){if(d){var a=$("input.integer",d).val(),c=$("input.double",
d).val(),b=0;a&&c&&(b=a*c,$("td:eq(3) span.info",d).text(b));return b}else{var e=0;$("#orderItems tbody tr").each(function(){e+=f(this)});e>0&&$("#amount").text(e);(d=$("#discount").val())&&(e-=d);(d=$("#freight").val())&&(e-=d);$("#grandTotal").html(e>=0?e:'<span style="color:red;">\u8d1f\u6570</span>')}}})();
