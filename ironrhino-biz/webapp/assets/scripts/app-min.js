(function(){function g(b,a){a=="xls"?$(b).html("<span><span>\u5f53\u524d\u662fEXCEL,\u70b9\u51fb\u5207\u6362\u5230PDF</span></span>"):a=="pdf"&&$(b).html("<span><span>\u5f53\u524d\u662fPDF,\u70b9\u51fb\u5207\u6362\u5230EXCEL</span></span>");$("a.report").attr("href",function(c,d){c=d.indexOf("format=");c>0&&(d=d.substring(0,c-1));return d+("&format="+a)});$("form.report").each(function(){var c=$('input[name="format"]',this);c.length?c.val(a):$(this).prepend('<input type="hidden" name="format" value="'+
a+'"/>')})}Observation.app=function(){$("form.report").attr("target","_blank");$("#format").toggle(function(){g(this,"xls")},function(){g(this,"pdf")});$("#shipped,#paid").click(function(){var a=$(this).nextAll("span:eq(0)");$(this).is(":checked")?a.show():a.hide()});$("#customerName").blur(function(a){var c=$(a.target);(a=c.val())&&$.ajax({url:CONTEXT_PATH+"/biz/customer/json/"+a,dataType:"json",success:function(a){var e=$('select[name="salesman.id"]',c.closest("form")),b=$('select[name="stationId"]',
c.closest("form"));a&&a.id?(c.val(a.name).siblings("span.info").html(""),a.memo&&(a=$.parseJSON(a.memo),document.location.search.indexOf("salesman.id")<0&&(a.salesman?e.val(a.salesman):$("option:selected",e).removeAttr("selected")),a.station?b.val(a.station):$("option:selected",b).removeAttr("selected"))):(document.location.search.indexOf("salesman.id")<0&&$("option:selected",e).removeAttr("selected"),$("option:selected",b).removeAttr("selected"),c.siblings("span.info").html("\u5c06\u81ea\u52a8\u4fdd\u5b58\u4e3a\u65b0\u5ba2\u6237"))}})});
var b={};$(".customerName").autocomplete({minLength:2,source:function(a,c){a.term in b?c(b[a.term]):$.ajax({url:CONTEXT_PATH+"/biz/customer/suggest",dataType:"json",data:a,success:function(d){b[a.term]=d;c(d)}})},select:function(a){$(a.target).siblings("span.info").html("")}});$("select.fetchprice").change(function(a){var c=$(a.target),b=$("input.price:eq(0)",c.closest("tr"));(a=c.val())&&!b.val()&&$.ajax({url:CONTEXT_PATH+"/biz/product/json/"+a,dataType:"json",success:function(a){a.price&&(b.val(a.price),
f());a.stock<=0?c.siblings("span.info").html("\u6ca1\u6709\u5e93\u5b58"):c.siblings("span.info").html("")}})});$("#orderItems input.quantity").blur(function(a){f();var c=$(a.target).val();if(c){var b=$("select.fetchprice",$(a.target).closest("tr"));(a=b.val())&&!b.siblings("span.info").text()&&$.ajax({url:CONTEXT_PATH+"/biz/product/json/"+a,dataType:"json",success:function(a){$("input.price:eq(0)",b.closest("tr")).val(a.price||"");a.stock<c&&b.siblings("span.info").html("\u5e93\u5b58\u4e0d\u591f")}})}});
$("#orderItems input.price,#discount,#freight").blur(function(){f()});$("#orderItems table").datagridTable({onremove:f})};var f=function(b){if(b){var a=$("input.integer",b).val(),c=$("input.double",b).val(),d=0;a&&c&&(d=a*c,$("td:eq(3) span.info",b).text(d));return d}else{var e=0;$("#orderItems tbody tr").each(function(){e+=f(this)});e>0&&$("#amount").text(e);(b=$("#discount").val())&&(e-=b);(b=$("#freight").val())&&(e-=b);$("#grandTotal").html(e>=0?e:'<span style="color:red;">\u8d1f\u6570</span>')}}})();
