(function(){Observation.app=function(){$("#shipped").click(function(){var a=$(this).nextAll("span:eq(0)");$(this).attr("checked")?a.show():a.hide()});$("#customerName").blur(function(a){var c=$(a.target);(a=c.val())&&$.ajax({url:CONTEXT_PATH+"/customer/json/"+a,dataType:"json",success:function(b){var d=$('select[name="salesman.id"]',c.closest("form")),e=$('select[name="stationId"]',c.closest("form"));if(b&&b.id){c.val(b.name).siblings("span.info").html("");if(b.memo){b=$.parseJSON(b.memo);if(document.location.search.indexOf("salesman.id")<
0)b.salesman?d.val(b.salesman):$("option:selected",d).removeAttr("selected");b.station?e.val(b.station):$("option:selected",e).removeAttr("selected")}}else{document.location.search.indexOf("salesman.id")<0&&$("option:selected",d).removeAttr("selected");$("option:selected",e).removeAttr("selected");c.siblings("span.info").html("\u5c06\u81ea\u52a8\u4fdd\u5b58\u4e3a\u65b0\u5ba2\u6237")}}})});$(".customerName").autocomplete(CONTEXT_PATH+"/customer/suggest?decorator=none",{max:1E3,minChars:2,delay:500});
$("select.fetchprice").change(function(a){var c=$(a.target),b=$("input.price:eq(0)",c.closest("tr"));(a=c.val())&&!b.val()&&$.ajax({url:CONTEXT_PATH+"/product/json/"+a,dataType:"json",success:function(d){if(d.price){b.val(d.price);f()}d.stock<=0?c.siblings("span.info").html("\u6ca1\u6709\u5e93\u5b58"):c.siblings("span.info").html("")}})});$("#orderItems input.quantity").blur(function(a){f();var c=$(a.target).val();if(c){var b=$("select.fetchprice",$(a.target).closest("tr"));(a=b.val())&&!b.siblings("span.info").text()&&
$.ajax({url:CONTEXT_PATH+"/product/json/"+a,dataType:"json",success:function(d){$("input.price:eq(0)",b.closest("tr")).val(d.price||"");d.stock<c&&b.siblings("span.info").html("\u5e93\u5b58\u4e0d\u591f")}})}});$("#orderItems input.price,#discount,#freight").blur(function(){f()});$("#orderItems table").datagridTable({onremove:f})};var f=function(a){if(a){var c=$("input.integer",a).val(),b=$("input.double",a).val(),d=0;if(c&&b){d=c*b;$("td:eq(3) span.info",a).text(d)}return d}else{var e=0;$("#orderItems tbody tr").each(function(){e+=
f(this)});e>0&&$("#amount").text(e);if(a=$("#discount").val())e-=a;if(a=$("#freight").val())e-=a;$("#grandTotal").html(e>=0?e:'<span style="color:red;">\u8d1f\u6570</span>')}}})();
