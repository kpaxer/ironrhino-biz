(function(){Observation.app=function(){$("form.report").attr("target","_blank");$("#report_format").children().click(function(){var a=$(this).attr("format");$("a.report").attr("href",function(b,c){b=c.indexOf("format=");b>0&&(c=c.substring(0,b-1));return c+("&format="+a)});$("form.report").each(function(){var b=$('input[name="format"]',this);b.length?b.val(a):$(this).prepend('<input type="hidden" name="format" value="'+a+'"/>')})});$("#shipped,#paid").click(function(){var a=$(this).nextAll("span:eq(0)");
$(this).is(":checked")?a.show():a.hide()});$(':input["name=categoryId"].changeEditAttributes').removeClass("changeEditAttributes").change(function(){var a=$(this).val(),b=$(":input[name=product.id]",$(this).closest("form")).val();if(a){var c=$(this).closest("form").attr("action"),c=c.substring(0,c.lastIndexOf("/"))+"/input?categoryId="+a+(b?"&id="+b:"");ajax({url:c,replacement:"editAttributes"})}});$("#customerName").blur(function(a){var b=$(a.target);(a=b.val())&&$.ajax({url:CONTEXT_PATH+"/biz/customer/json/"+
a,dataType:"json",success:function(a){var e=$('select[name="salesman.id"]',b.closest("form")),d=$('select[name="stationId"]',b.closest("form"));a&&a.id?(b.val(a.name).siblings("span.info").html(""),a.memo&&(a=$.parseJSON(a.memo),document.location.search.indexOf("salesman.id")<0&&(a.salesman?e.val(a.salesman):$("option:selected",e).removeAttr("selected")),a.station?d.val(a.station):$("option:selected",d).removeAttr("selected"))):(document.location.search.indexOf("salesman.id")<0&&$("option:selected",
e).removeAttr("selected"),$("option:selected",d).removeAttr("selected"),b.siblings("span.info").html("\u5c06\u81ea\u52a8\u4fdd\u5b58\u4e3a\u65b0\u5ba2\u6237"))}})});var d={};$(".customerName").autocomplete({minLength:2,source:function(a,b){a.term in d?b(d[a.term]):$.ajax({url:CONTEXT_PATH+"/biz/customer/suggest",dataType:"json",data:a,success:function(c){d[a.term]=c;b(c)}})},select:function(a){$(a.target).siblings("span.info").html("")}});$("select.fetchprice").change(function(a){var b=$(a.target),
c=$("input.price:eq(0)",b.closest("tr"));(a=b.val())&&!c.val()&&$.ajax({url:CONTEXT_PATH+"/biz/product/json/"+a,dataType:"json",success:function(a){a.price&&(c.val(a.price),f());a.stock<=0?b.siblings("span.info").html("\u6ca1\u6709\u5e93\u5b58"):b.siblings("span.info").html("")}})});$("#orderItems input.quantity").blur(function(a){f();var b=$(a.target).val();if(b){var c=$("select.fetchprice",$(a.target).closest("tr"));(a=c.val())&&!c.siblings("span.info").text()&&$.ajax({url:CONTEXT_PATH+"/biz/product/json/"+
a,dataType:"json",success:function(a){$("input.price:eq(0)",c.closest("tr")).val(a.price||"");a.stock<b&&c.siblings("span.info").html("\u5e93\u5b58\u4e0d\u591f")}})}});$("#orderItems input.price,#discount,#freight").blur(function(){f()});$("#orderItems table").datagridTable({onremove:f});$("table.unpaid_order a.pay").each(function(){this.onsuccess=function(){$(this).closest("tr").remove();g()}})};var f=function(d){if(d){var a=$("input.integer",d).val(),b=$("input.double",d).val(),c=0;a&&b&&(c=a*b,
$("td:eq(3) span.info",d).text(c));return c}else{var e=0;$("#orderItems tbody tr").each(function(){e+=f(this)});e>0&&$("#amount").text(e);(d=$("#discount").val())&&(e-=d);(d=$("#freight").val())&&(e-=d);$("#grandTotal").html(e>=0?e:'<span style="color:red;">\u8d1f\u6570</span>')}},g=function(){var d=$("table.unpaid_order"),a=0;$("tbody tr",d).each(function(){$("td:eq(3)",this).each(function(){a+=parseFloat($(this).text())})});$("tfoot td:eq(3)",d).text(a);return a}})();
